---
phase: 03-cinematic-sequence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/CinematicSequence.tsx
  - app/page.tsx
  - app/globals.css
autonomous: false

must_haves:
  truths:
    - "Homepage auto-plays a multi-beat timed sequence (elements appear progressively, not all at once)"
    - "Sequence displays text anchored to London (e.g. 'Something is coming to London') during playback"
    - "Waitlist form appears as the final beat of the sequence (hidden until reveal for new visitors)"
    - "Returning visitors (localStorage 'street-visited' flag) see all content immediately with no animation"
    - "Sequence respects prefers-reduced-motion (all content visible immediately, no animation)"
  artifacts:
    - path: "app/components/CinematicSequence.tsx"
      provides: "Timed multi-beat reveal orchestrator with returning visitor detection"
      min_lines: 50
    - path: "app/page.tsx"
      provides: "Server component integrating CinematicSequence"
      contains: "CinematicSequence"
    - path: "app/globals.css"
      provides: "Keyframe animations for sequence beats"
      contains: "@keyframes"
  key_links:
    - from: "app/components/CinematicSequence.tsx"
      to: "app/components/HomepageSignup.tsx"
      via: "imports and renders as final sequence beat"
      pattern: "import.*HomepageSignup"
    - from: "app/components/CinematicSequence.tsx"
      to: "localStorage"
      via: "reads 'street-visited' on mount, writes after sequence completes"
      pattern: "localStorage\\.(get|set)Item.*street-visited"
    - from: "app/page.tsx"
      to: "app/components/CinematicSequence.tsx"
      via: "imports and renders within mystery-container"
      pattern: "import.*CinematicSequence"
---

<objective>
Build the complete cinematic sequence that auto-plays a multi-beat timed experience on the homepage, building tension through progressive reveals and culminating with the waitlist form.

Purpose: Transform the static homepage into a cinematic teaser that hooks first-time visitors with pacing and mystery, while returning visitors skip straight to the waitlist form.

Output: Working timed sequence with CSS animations, returning visitor detection, and reduced-motion support.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Source files being modified/used:
@app/page.tsx
@app/components/AnimatedBackground.tsx
@app/components/HomepageSignup.tsx
@app/globals.css

# Key prior decisions:
# - 01-01: Tagline "Something is coming." is placeholder for Phase 3 replacement
# - 01-02: Belt-and-suspenders reduced-motion: CSS hides visuals, JS prevents computation
# - 02-fix: Strobing image flash removed — use SMOOTH reveals only, never jarring transitions
# - 02-01: Neon glow via triple-layer text-shadow on .mystery-logo
# - 02-02: Film grain canvas at 15fps stays as persistent backdrop (AnimatedBackground)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CinematicSequence component with timed reveals and returning visitor detection</name>
  <files>app/components/CinematicSequence.tsx, app/page.tsx</files>
  <action>
    Create new client component `app/components/CinematicSequence.tsx` that orchestrates a multi-beat timed sequence replacing the static mystery-content children.

    **Component design:**
    - Renders the `.mystery-content` wrapper div (move from page.tsx into this component)
    - Contains all content: logo, tagline, and HomepageSignup form
    - Uses a CSS class-based approach: start with `sequence-pending` class, switch to `sequence-play` or `sequence-skip` on mount

    **State logic (useEffect on mount):**
    1. Check `window.matchMedia('(prefers-reduced-motion: reduce)')` — if true, set skip mode
    2. Check `localStorage.getItem('street-visited')` — if exists, set skip mode
    3. If skip mode: set container class to `sequence-skip` (all content visible immediately)
    4. If play mode: set container class to `sequence-play` (triggers CSS animation sequence)
    5. After sequence completes (~8-9s), call `localStorage.setItem('street-visited', '1')`

    **Sequence beats (play mode — all timing driven by CSS animation-delay):**
    - Beat 0 (0-2s): Dark screen, only film grain visible. All content opacity: 0.
    - Beat 1 (2s): "STREET" logo fades in with neon glow (class `sequence-beat-1`)
    - Beat 2 (5s): Tagline fades in below logo (class `sequence-beat-2`)
    - Beat 3 (7.5s): Waitlist form fades in as the climax/payoff (class `sequence-beat-3`)

    **Tagline content:** Replace "Something is coming." with "Something is coming to London." — anchoring the mystery to London per SEQ-02. Keep the same mystery-tagline class for styling.

    **Skip mode:** Container has `sequence-skip` class. All beat elements have `opacity: 1` and `transform: none` immediately. No animation.

    **Pending mode (SSR default):** Container has `sequence-pending` class. All beat elements hidden (opacity: 0). This prevents flash of content before JS determines play vs skip. The dark background means no visual jarring — user sees darkness + film grain for 1 frame until JS runs.

    **Import HomepageSignup** and render it as the final beat content, wrapped in a div with `sequence-beat-3` class.

    **Update page.tsx:**
    - Remove HomepageSignup import (now imported inside CinematicSequence)
    - Remove the `<div className="mystery-content">` and its children
    - Import and render `<CinematicSequence />` after `<AnimatedBackground />`
    - Keep page.tsx as a server component (CinematicSequence is the client boundary)

    **What to avoid:**
    - Do NOT use setTimeout/setInterval for animation timing — use CSS animation-delay (GPU-accelerated, declarative, no timer leaks)
    - Do NOT use GSAP or any external library — CSS keyframes are sufficient
    - Do NOT add `if (!mounted) return null` — always render content for SSR/SEO, use CSS to control visibility
    - Do NOT use jarring effects (flickers, strobes, glitches) — lesson from 02-fix, smooth fades only
  </action>
  <verify>
    npm run build succeeds without errors. Check that page.tsx imports CinematicSequence and no longer directly renders logo/tagline/form. Check CinematicSequence.tsx exists with localStorage logic and beat classes.
  </verify>
  <done>
    CinematicSequence component created with timed beat orchestration. page.tsx updated to use it. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS keyframe animations for sequence beats</name>
  <files>app/globals.css</files>
  <action>
    Add CSS at the end of the MYSTERY LANDING PAGE section in globals.css (before the REDUCED MOTION section).

    **Keyframe definition:**
    ```
    @keyframes sequenceFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    ```

    **Sequence-pending state** (SSR default — hidden until JS decides):
    ```
    .sequence-pending .sequence-beat-1,
    .sequence-pending .sequence-beat-2,
    .sequence-pending .sequence-beat-3 {
      opacity: 0;
    }
    ```

    **Sequence-play state** (first-time visitor — progressive animation):
    ```
    .sequence-play .sequence-beat-1,
    .sequence-play .sequence-beat-2,
    .sequence-play .sequence-beat-3 {
      opacity: 0;
    }

    .sequence-play .sequence-beat-1 {
      animation: sequenceFadeIn 1.5s ease-out 2s forwards;
    }

    .sequence-play .sequence-beat-2 {
      animation: sequenceFadeIn 1s ease-out 5s forwards;
    }

    .sequence-play .sequence-beat-3 {
      animation: sequenceFadeIn 1s ease-out 7.5s forwards;
    }
    ```

    **Sequence-skip state** (returning visitor — everything visible):
    ```
    .sequence-skip .sequence-beat-1,
    .sequence-skip .sequence-beat-2,
    .sequence-skip .sequence-beat-3 {
      opacity: 1;
    }
    ```

    **Update reduced-motion section:**
    In the existing `@media (prefers-reduced-motion: reduce)` block, add rules to ensure sequence elements are visible (same as skip state). This is belt-and-suspenders with the JS check — CSS handles it even if JS fails:
    ```
    .sequence-play .sequence-beat-1,
    .sequence-play .sequence-beat-2,
    .sequence-play .sequence-beat-3 {
      animation: none;
      opacity: 1;
    }
    ```

    **Timing rationale:**
    - 2s initial darkness creates anticipation (film grain visible, building tension)
    - Logo at 2s: 1.5s fade-in (slower, more dramatic entrance)
    - Tagline at 5s: 1s fade-in (slightly faster, momentum building)
    - Form at 7.5s: 1s fade-in (the payoff)
    - Total sequence: ~8.5s from dark to fully revealed

    **What to avoid:**
    - Do NOT add transform animations to `.mystery-logo` that conflict with its existing text-shadow glow
    - Do NOT modify existing `.mystery-*` class styles — only add new `.sequence-*` classes
    - Keep the subtle translateY(10px) on fade-in for gentle upward motion, nothing dramatic
  </action>
  <verify>
    npm run build succeeds. Grep globals.css for `@keyframes sequenceFadeIn` — must exist. Grep for `sequence-play`, `sequence-skip`, `sequence-pending` — all three states must have rules. Verify reduced-motion section has sequence override.
  </verify>
  <done>
    CSS animations added for all three sequence states (pending, play, skip). Keyframe animation defined. Reduced-motion override in place. Build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete cinematic sequence with 4 beats: 2s darkness → logo fade-in → tagline "Something is coming to London." → waitlist form reveal. Film grain overlay persists throughout. Returning visitors skip to fully-visible state.
  </what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open incognito/private window (clean localStorage)
    3. Visit: http://localhost:3000
    4. **First-time experience:** Verify timed sequence:
       - ~2s of darkness with film grain only
       - "STREET" logo fades in with neon glow
       - ~3s later, "Something is coming to London." fades in
       - ~2.5s later, waitlist form (name + email + ENTER button) fades in
       - Total sequence feels cinematic, not rushed
    5. Refresh the same page (now a returning visitor):
       - All content should be visible immediately, no animation replay
    6. Test on mobile viewport (375px width):
       - Sequence should play smoothly without frame drops
       - All elements properly centered and readable
    7. (Optional) Test reduced-motion:
       - In browser DevTools, enable "Emulate CSS prefers-reduced-motion: reduce"
       - Reload: All content visible immediately, no animation
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe timing/visual issues to adjust</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes (no TypeScript errors)
- [ ] CinematicSequence.tsx exists with localStorage and reduced-motion checks
- [ ] page.tsx imports CinematicSequence, no longer directly renders logo/tagline
- [ ] CSS has @keyframes sequenceFadeIn and all three state classes
- [ ] Reduced-motion CSS override exists in prefers-reduced-motion block
- [ ] Human verified: sequence plays correctly for first-time visitors
- [ ] Human verified: returning visitors skip sequence
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Multi-beat timed sequence plays for first-time visitors (SEQ-01)
- "Something is coming to London" displayed during sequence (SEQ-02)
- Returning visitors skip to waitlist form (SEQ-04)
- Reduced-motion users see all content immediately
- No performance degradation on mobile
  </success_criteria>

<output>
After completion, create `.planning/phases/03-cinematic-sequence/03-01-SUMMARY.md`
</output>
